#! /bin/bash

# =========================================================================================================
echo ---------------------------------------- Environment ----------------------------------------------
echo "User is" `whoami`
echo "Current dir is" `pwd`
printenv
ls -ld .
echo ---------------------------------------- processing log ----------------------------------------------

# =========================================================================================================
/usr/bin/time --verbose -o metrics.out /bin/bash -c "( python -m hstdputils.process $* ) |& tee process.out"

# =========================================================================================================
echo ---------------------------------------- program metrics ---------------------------------------------
cat metrics.out

# =========================================================================================================
export bucket=$1
export prefix=$2
aws s3 cp  --quiet process.out  ${bucket}/${prefix}/
aws s3 cp  --quiet metrics.out  ${bucket}/${prefix}/


